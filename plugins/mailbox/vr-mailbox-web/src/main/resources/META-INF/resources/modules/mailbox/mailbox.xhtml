<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.

and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
>

<h:head>
</h:head>

<h:body>

    <!--@elvariable id="vr" type="net.thevpc.app.vainruling.core.web.jsf.Vr"-->
    <!--@elvariable id="mailboxCtrl" type="net.thevpc.app.vainruling.plugins.mailbox.web.MailboxCtrl"-->

    <ui:composition template="#{vr.privateTemplatePath}">
        <ui:define name="content">
            <h:form id="mainForm" enctype="multipart/form-data">
                <p:messages id="msgs" showDetail="true"/>
                <div class="row">
                    <div class="col-md-3">

                        <p:commandButton value="Composer" rendered="#{mailboxCtrl.isEnabledButton('New')}"
                                         styleClass="btn btn-primary btn-block margin-bottom" ajax="true"
                                         actionListener="#{mailboxCtrl.onNew}"
                                         update=":mainForm"/>

                        <p:commandButton value="Inbox" rendered="#{mailboxCtrl.isEnabledButton('BackToInbox')}"
                                         styleClass="btn btn-primary btn-block margin-bottom" ajax="true"
                                         actionListener="#{mailboxCtrl.onCancelCurrent}"
                                         update=":mainForm"/>

                        <div class="box box-solid">
                            <div class="box-header with-border">
                                <h3 class="box-title">Dossiers</h3>

                                <div class="box-tools">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                            class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="box-body no-padding">
                                <ul class="nav nav-pills nav-stacked">
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'CURRENT' and not mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectInboxFolder}" ajax="false">
                                            <i class="fa fa-inbox"></i> Réception
                                            <ui:fragment rendered="#{mailboxCtrl.model.countInbox gt 0}">
                                                <span class="label label-success pull-right">#{mailboxCtrl.model.countInbox}</span>
                                            </ui:fragment>
                                        </p:commandLink>
                                    </li>
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'CURRENT' and mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectOutboxFolder}"
                                                       ajax="false">
                                            <i class="fa fa-envelope-o"></i> Envoi
                                            <ui:fragment rendered="#{mailboxCtrl.model.countOutbox gt 0}">
                                                <span class="label label-success pull-right">#{mailboxCtrl.model.countOutbox}</span>
                                            </ui:fragment>
                                        </p:commandLink>
                                    </li>
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'DELETED' and not mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectDeletedInboxFolder}"
                                                       ajax="false">
                                            <i class="fa fa-trash-o"></i> Corbeille Réception</p:commandLink>
                                    </li>
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'DELETED' and mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectDeletedOutboxFolder}"
                                                       ajax="false">
                                            <i class="fa fa-trash"></i> Corbeille Envoi</p:commandLink>
                                    </li>
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'ARCHIVED' and not mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectArchivedInboxFolder}"
                                                       ajax="false">
                                            <i class="fa fa-file-text-o"></i> Archive Réception</p:commandLink></li>
                                    <li class="#{(mailboxCtrl.model.folder.toString() eq 'ARCHIVED' and mailboxCtrl.model.sent) ? 'active':''}">
                                        <p:commandLink actionListener="#{mailboxCtrl.onSelectArchivedOutboxFolder}"
                                                       ajax="false">
                                            <i class="fa fa-file-text"></i> Archive Envoi</p:commandLink></li>
                                </ul>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!--
                        <div class="box box-solid">
                            <div class="box-header with-border">
                                <h3 class="box-title">Labels</h3>

                                <div class="box-tools">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                            class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="box-body no-padding">
                                <ul class="nav nav-pills nav-stacked">
                                    <li><a href="#"><i class="fa fa-circle-o text-red"></i> Important</a></li>
                                    <li><a href="#"><i class="fa fa-circle-o text-yellow"></i> Promotions</a></li>
                                    <li><a href="#"><i class="fa fa-circle-o text-light-blue"></i> Social</a></li>
                                </ul>
                            </div>
                        </div>
                            -->
                        <!-- /.box -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-9">
                        <ui:fragment rendered="#{mailboxCtrl.model.mode.toString() eq 'READ'}">
                            <div class="box box-primary">

                                <div class="box-header with-border">
                                    <h3 class="box-title">#{mailboxCtrl.model.title}</h3>

                                    <div class="box-tools pull-right">
                                        <div class="has-feedback">
                                            <input type="text" class="form-control input-sm" placeholder="Chercher ..."
                                                   disabled="disabled"/>
                                            <span class="glyphicon glyphicon-search form-control-feedback"></span>
                                        </div>
                                    </div>
                                    <!-- /.box-tools -->
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body no-padding">
                                    <div class="mailbox-controls">
                                        <!-- Check all button -->
                                        <div class="btn-group">
                                            <p:commandButton title="Supprimer"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Remove')}"
                                                             icon="fa fa-trash-o"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             onclick="PF('confirmationDelete').show();"></p:commandButton>
                                            <p:commandButton title="Archiver"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Archive')}"
                                                             icon="fa fa-archive"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             onclick="PF('confirmationArchive').show();"></p:commandButton>
                                        </div>
                                        <!-- /.btn-group -->
                                        <p:commandButton title="Refraichir"
                                                         icon="fa fa-refresh"
                                                         styleClass="btn btn-default btn-sm" ajax="true"
                                                         actionListener="#{mailboxCtrl.onRefresh}"
                                                         update=":mainForm"></p:commandButton>
                                        <div class="pull-right">
                                            <div class="btn-group">
                                            </div>
                                            <!-- /.btn-group -->
                                        </div>
                                        <!-- /.pull-right -->
                                    </div>

                                    <div class="table-responsive mailbox-messages">
                                        <p:dataTable id="listTable2" var="i" value="#{mailboxCtrl.model.inbox}"
                                                     class="table table-hover table-striped hide-column-names"
                                                     paginatorAlwaysVisible="false"
                                                     paginator="true"
                                                     paginatorPosition="bottom"
                                                     emptyMessage="Aucun message"
                                                     rows="50"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     rowsPerPageTemplate="20,50,100,200,1000"
                                        >

                                            <!--                                    <f:facet name="header">
                                                                                    List
                                                                                    <p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
                                                                                    <p:columnToggler datasource="cars" trigger="toggler" />
                                                                                </f:facet>-->
                                            <p:column headerText=""
                                                      style="border-right: 0px !important;width: 25px; padding-left: 5px">
                                                <p:selectBooleanCheckbox value="#{i.selected}">
                                                </p:selectBooleanCheckbox>
                                            </p:column>
                                            <p:column headerText="" styleClass="vr-mailbox-name">
                                                <img src="#{vr.url(i.value.userPhoto)}"
                                                     class="vr-mailbox-user-photo"
                                                     alt="User Image"/>
                                                <a href="#" class="vr-mailbox-star-link"><i
                                                        class="fa #{i.value.important ?'fa-star text-yellow':'fa-star-o text-gray'} vr-mailbox-star-icon"
                                                        title="#{i.value.important ?'important':'priorité normale'}"
                                                ></i></a>
                                                <p:commandLink styleClass="vr-mailbox-star-link"
                                                               actionListener="#{mailboxCtrl.switchReadFlag(i)}"
                                                               update=":mainForm"><i
                                                        class="fa #{i.value.read ?'fa-eye text-gray':'fa-eye-slash text-green'}  vr-mailbox-star-icon"
                                                        title="#{i.value.read ?'déjà lu':'non lu'}"
                                                ></i></p:commandLink>
                                                <p:commandLink ajax="false"
                                                               actionListener="#{mailboxCtrl.onSelect(i.value)}"
                                                               update=":mainForm :pageTitleForm">

                                                <span class="pull-right-container">
                                                    <small class="label pull-right vr-mailbox-label-emblem #{vr.hashToArr(i.value.category,'bg-red','bg-yellow','bg-aqua','bg-blue','bg-light-blue','bg-green','bg-navy','bg-teal','bg-olive','bg-lime','bg-orange','bg-fuchsi','bg-purple','bg-maroon','bg-black')}">#{vr.strcut(i.value.category, 10)}</small>
                                                </span>
                                                    <p:outputLabel
                                                            value="#{vr.strcat(mailboxCtrl.model.sent ?'A: ':'De: ',i.value.userFullName)}"
                                                            styleClass="vr-mailbox-name-label"/>
                                                </p:commandLink>
                                            </p:column>
                                            <p:column headerText="" styleClass="vr-mailbox-subject">
                                                <p:commandLink ajax="false"
                                                               actionListener="#{mailboxCtrl.onSelect(i.value)}"
                                                               update=":mainForm :pageTitleForm">
                                                    <p:outputLabel
                                                            styleClass="#{i.value.read ?'vr-mailbox-read':'vr-mailbox-unread'}"
                                                            value="#{vr.strexpand(vr.strcut(i.value.subject, 50),'.',3)}"/>
                                                    <p:spacer width="10" height="10"/>
                                                    <p:outputLabel value="-"/>
                                                    <p:spacer width="10" height="10"/>
                                                    <p:outputLabel style="
                                                           #{i.value.read?'color: #9F9F9F;':'color: #797A7B;'}
                                                           "
                                                                   value="#{vr.strcut(vr.html2txt(i.value.content), 60)}"/>
                                                    <f:setPropertyActionListener target="#{mailboxCtrl.model.current}"
                                                                                 value="#{i.value}"/>
                                                </p:commandLink>
                                                <ui:fragment rendered="#{!vr.isEmpty(i.value.category)}">
                                                </ui:fragment>
                                            </p:column>
                                            <p:column class="vr-mailbox-attachment">
                                                <ui:fragment rendered="#{i.value.hasAttachment()}">
                                                    <i class="fa fa-paperclip"></i>
                                                </ui:fragment>
                                            </p:column>
                                            <p:column headerText="" styleClass="vr-mailbox-date">
                                                <p:commandLink ajax="false"
                                                               actionListener="#{mailboxCtrl.onSelect(i.value)}"
                                                               update=":mainForm :pageTitleForm">

                                                    <p:outputLabel value="#{i.value.sendTime}">
                                                        <f:converter converterId="RelativeDateConverter"/>
                                                    </p:outputLabel>
                                                </p:commandLink>
                                            </p:column>
                                            <f:facet name="footer">
                                                <p:outputLabel value="Total #{mailboxCtrl.model.inbox.size()}"/>
                                            </f:facet>
                                        </p:dataTable>
                                        <!-- /.table -->
                                    </div>
                                    <!-- /.mail-box-messages -->
                                </div>
                                <!-- /.box-body -->
                                <div class="box-footer no-padding">
                                    <div class="mailbox-controls">
                                        <!-- Check all button -->
                                        <div class="btn-group">
                                            <p:commandButton title="Supprimer"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Remove')}"
                                                             icon="fa fa-trash-o"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             onclick="PF('confirmationDelete').show();"></p:commandButton>
                                            <p:commandButton title="Archiver"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Archive')}"
                                                             icon="fa fa-archive"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             onclick="PF('confirmationArchive').show();"></p:commandButton>
                                        </div>
                                        <!-- /.btn-group -->
                                        <p:commandButton title="Refraichir"
                                                         icon="fa fa-refresh"
                                                         styleClass="btn btn-default btn-sm" ajax="true"
                                                         actionListener="#{mailboxCtrl.onRefresh}"
                                                         update=":mainForm"></p:commandButton>
                                        <div class="pull-right">
                                            <div class="btn-group">
                                            </div>
                                            <!-- /.btn-group -->
                                        </div>
                                        <!-- /.pull-right -->
                                    </div>
                                </div>
                            </div>
                        </ui:fragment>


                        <ui:fragment rendered="#{mailboxCtrl.model.mode.toString() eq 'UPDATE'}">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Lire Mail</h3>

                                    <div class="box-tools pull-right">
                                        <a href="#" class="btn btn-box-tool" data-toggle="tooltip" title="Previous"><i
                                                class="fa fa-chevron-left"></i></a>
                                        <a href="#" class="btn btn-box-tool" data-toggle="tooltip" title="Next"><i
                                                class="fa fa-chevron-right"></i></a>
                                    </div>
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body no-padding">
                                    <div class="mailbox-read-info">
                                        <h3>#{mailboxCtrl.model.current.subject}</h3>
                                        <h5>#{vr.strcat(mailboxCtrl.model.sent ?'A: ':'De: ',mailboxCtrl.model.current.userFullName)}
                                            <span class="mailbox-read-time pull-right">#{vr.date(mailboxCtrl.model.current.sendTime)}</span>
                                        </h5>
                                    </div>
                                    <!-- /.mailbox-read-info -->
                                    <div class="mailbox-controls with-border text-center">
                                        <div class="btn-group">
                                            <p:commandButton title="Supprimer"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Remove')}"
                                                             icon="fa fa-trash-o"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             onclick="PF('confirmationDelete').show();"></p:commandButton>

                                            <p:commandButton title="Répondre"
                                                             rendered="#{mailboxCtrl.isEnabledButton('Reply')}"
                                                             icon="fa fa-mail-reply"
                                                             styleClass="btn btn-default btn-sm" ajax="true"
                                                             actionListener="#{mailboxCtrl.onReply}"
                                                             update=":mainForm :pageTitleForm"/>

                                        </div>
                                    </div>
                                    <!-- /.mailbox-controls -->
                                    <div class="mailbox-read-message">
                                        <p:outputLabel
                                                style="font-style: normal;#{mailboxCtrl.model.current.richText ?'':'white-space: pre-wrap'}"
                                                value="#{mailboxCtrl.model.current.richText ?  vr.replaceCustomURLs(mailboxCtrl.model.current.content) :  mailboxCtrl.model.current.content}"
                                                escape="#{not mailboxCtrl.model.current.richText}"/>
                                    </div>
                                    <!-- /.mailbox-read-message -->
                                </div>
                                <!-- /.box-body -->
                                <div class="box-footer">
                                    <!--
                                    <ul class="mailbox-attachments clearfix">
                                        <li>
                                            <span class="mailbox-attachment-icon"><i class="fa fa-file-pdf-o"></i></span>

                                            <div class="mailbox-attachment-info">
                                                <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> Sep2014-report.pdf</a>
                                                <span class="mailbox-attachment-size">
                              1,245 KB
                              <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                            </span>
                                            </div>
                                        </li>
                                        <li>
                                            <span class="mailbox-attachment-icon"><i class="fa fa-file-word-o"></i></span>

                                            <div class="mailbox-attachment-info">
                                                <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> App Description.docx</a>
                                                <span class="mailbox-attachment-size">
                              1,245 KB
                              <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                            </span>
                                            </div>
                                        </li>
                                        <li>
                                            <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo1.png" alt="Attachment"></span>

                                            <div class="mailbox-attachment-info">
                                                <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo1.png</a>
                                                <span class="mailbox-attachment-size">
                              2.67 MB
                              <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                            </span>
                                            </div>
                                        </li>
                                        <li>
                                            <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo2.png" alt="Attachment"></span>

                                            <div class="mailbox-attachment-info">
                                                <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo2.png</a>
                                                <span class="mailbox-attachment-size">
                              1.9 MB
                              <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                            </span>
                                            </div>
                                        </li>
                                    </ul>
                                -->
                                </div>
                            </div>
                            <ui:repeat value="#{mailboxCtrl.model.threadList}" var="tm">
                                <div class="box box-default">

                                    <div class="box-header with-border">
                                        <h3 class="box-title">#{tm.subject}</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body no-padding">
                                        <div class="mailbox-read-info">
                                            <h5>#{mailboxCtrl.model.sent ?vr.strcat('A: ',tm.userFullName): vr.strcat('De: ',tm.userFullName)}
                                                <span class="mailbox-read-time pull-right">#{vr.date(tm.sendTime)}</span>
                                            </h5>
                                        </div>
                                        <div class="mailbox-read-message">
                                            <p:outputLabel
                                                    style="font-style: normal;#{tm.richText ?'':'white-space: pre-wrap'}"
                                                    value="#{tm.richText ?  vr.replaceCustomURLs(tm.content) :  tm.content}"
                                                    escape="#{not tm.richText}"/>

                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                    <div class="box-footer">
                                        <!--
                                        <ul class="mailbox-attachments clearfix">
                                            <li>
                                                <span class="mailbox-attachment-icon"><i class="fa fa-file-pdf-o"></i></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> Sep2014-report.pdf</a>
                                                    <span class="mailbox-attachment-size">
                                  1,245 KB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon"><i class="fa fa-file-word-o"></i></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> App Description.docx</a>
                                                    <span class="mailbox-attachment-size">
                                  1,245 KB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo1.png" alt="Attachment"></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo1.png</a>
                                                    <span class="mailbox-attachment-size">
                                  2.67 MB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo2.png" alt="Attachment"></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo2.png</a>
                                                    <span class="mailbox-attachment-size">
                                  1.9 MB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                        </ul>
                                    -->
                                    </div>
                                </div>
                            </ui:repeat>
                            <!-- /.box-footer -->
                        </ui:fragment>

                        <ui:fragment rendered="#{mailboxCtrl.model.mode.toString() eq 'PERSIST'}">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Nouveau Message</h3>
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body">
                                    <div class="form-group">
                                        <p:autoComplete id="txtto"
                                                        styleClass="vr-form-control vr-form-control-with-button60"
                                                        placeholder="A:" value="#{mailboxCtrl.model.newItem.toProfiles}"
                                                        completeMethod="#{mailboxCtrl.completeProfileExpr}"
                                                        queryDelay="1000"
                                        >
                                            <p:ajax event="blur" listener="#{mailboxCtrl.updateUserCounts}"
                                                    process="@this"
                                                    update="btnto"/>
                                        </p:autoComplete>
                                        <p:commandButton
                                                id="btnto"
                                                styleClass="vr-form-control-right-button60"
                                                ajax="true" value="#{mailboxCtrl.model.toCount}"
                                                icon="fa fa-users"
                                                actionListener="#{mailboxCtrl.openProfileExprDialog('to')}"
                                        >
                                            <p:ajax event="dialogReturn"
                                                    listener="#{mailboxCtrl.onProfileExprDialogClosed}"
                                                    update="txtto"/>
                                        </p:commandButton>
                                    </div>
                                    <div class="form-group">
                                        <p:autoComplete styleClass="vr-form-control" placeholder="Label:"
                                                        completeMethod="#{mailboxCtrl.completeCategoryExpr}"
                                                        value="#{mailboxCtrl.model.newItem.category}"/>
                                    </div>
                                    <div class="form-group">
                                        <p:inputText styleClass="form-control" placeholder="Sujet:"
                                                     value="#{mailboxCtrl.model.newItem.subject}"/>
                                    </div>
                                    <div class="form-group">
                                        <p:inputTextarea id="compose-textarea" styleClass="form-control"
                                                         value="#{mailboxCtrl.model.newItem.content}"/>
                                    </div>
                                    <!--<div class="form-group">-->
                                        <!--<p:fileUpload id="fileUpload" disabled="true"-->
                                                      <!--label="Attachements (Max. 15MB)"-->
                                                      <!--fileUploadListener="# {mailboxCtrl.onHandleProjectFileUpload}"-->
                                                      <!--mode="advanced"-->
                                                      <!--update=":mainForm" auto="true" sizeLimit="15000000"-->
                                                      <!--allowTypes="/(\.|\/)(pdf|zip|xls|xlsx|doc|docx|txt)$/"/>-->
                                        <!--<p class="help-block">Fichiers supportés : pdf,zip,xls,xlsx,doc,docx,txt</p>-->
                                    <!--</div>-->
                                    <div class="form-group">
                                        <ui:repeat value="#{mailboxCtrl.model.newItemAttachments}" var="att">
                                            <div class="btn btn-default btn-file">
                                                <i class="fa fa-paperclip"></i> #{att.name}
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </div>
                                <!-- /.box-body -->
                                <div class="box-footer">
                                    <div class="pull-right">
                                        <!--<button type="button" class="btn btn-default" disabled="disabled"><i class="fa fa-pencil"></i> Draft</button>-->
                                        <p:commandButton styleClass="btn btn-primary" icon="fa fa-envelope-o"
                                                         value="Envoyer" update=":mainForm"
                                                         actionListener="#{mailboxCtrl.onSend}"/>
                                    </div>
                                    <p:commandButton styleClass="btn btn-default" icon="fa fa-times" update=":mainForm"
                                                     actionListener="#{mailboxCtrl.onCancelCurrent}" value=" Annuler"/>
                                </div>
                            </div>
                            <ui:repeat value="#{mailboxCtrl.model.threadList}" var="tm">
                                <div class="box box-default">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">#{tm.subject}</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body no-padding">
                                        <div class="mailbox-read-info">
                                            <h5>#{mailboxCtrl.model.sent ?vr.strcat('A: ',tm.userFullName): vr.strcat('De: ',tm.userFullName)}
                                                <span class="mailbox-read-time pull-right">#{vr.date(tm.sendTime)}</span>
                                            </h5>
                                        </div>
                                        <div class="mailbox-read-message">
                                            <p:outputLabel style="font-style: normal;"
                                                           value="#{vr.replaceCustomURLs(tm.content)}"
                                                           escape="false"/>
                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                    <div class="box-footer">
                                        <!--
                                        <ul class="mailbox-attachments clearfix">
                                            <li>
                                                <span class="mailbox-attachment-icon"><i class="fa fa-file-pdf-o"></i></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> Sep2014-report.pdf</a>
                                                    <span class="mailbox-attachment-size">
                                  1,245 KB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon"><i class="fa fa-file-word-o"></i></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-paperclip"></i> App Description.docx</a>
                                                    <span class="mailbox-attachment-size">
                                  1,245 KB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo1.png" alt="Attachment"></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo1.png</a>
                                                    <span class="mailbox-attachment-size">
                                  2.67 MB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="mailbox-attachment-icon has-img"><img src="../../dist/img/photo2.png" alt="Attachment"></span>

                                                <div class="mailbox-attachment-info">
                                                    <a href="#" class="mailbox-attachment-name"><i class="fa fa-camera"></i> photo2.png</a>
                                                    <span class="mailbox-attachment-size">
                                  1.9 MB
                                  <a href="#" class="btn btn-default btn-xs pull-right"><i class="fa fa-cloud-download"></i></a>
                                </span>
                                                </div>
                                            </li>
                                        </ul>
                                    -->
                                    </div>
                                </div>
                            </ui:repeat>
                        </ui:fragment>
                        <!-- /. box -->
                    </div>
                    <!-- /.col -->
                </div>


                <p:confirmDialog message="Etes vous sur de vouloir supprimer cet élément ?"
                                 header="ATTENTION : Suppression" widgetVar="confirmationDelete">
                    <p:commandButton value="Oui En Effet" onclick="PF('confirmationDelete').hide();
                                processOnDeleteSelected();"/>
                    <p:commandButton value="Non merci" onclick="PF('confirmationDelete').hide()" type="button"/>
                </p:confirmDialog>

                <p:confirmDialog message="Etes vous sur de vouloir archiver cet élément ?"
                                 header="ATTENTION : Suppression" widgetVar="confirmationArchive">
                    <p:commandButton value="Oui En Effet" onclick="PF('confirmationArchive').hide();
                                processOnArchiveSelected();"/>
                    <p:commandButton value="Non merci" onclick="PF('confirmationArchive').hide()" type="button"/>
                </p:confirmDialog>

                <!-- /.row -->


                <!-- /.row -->

                <!--<p:messages/>-->
                <p:remoteCommand name="processOnSendCurrent" process="@form"
                                 update=":mainForm"
                                 action="#{mailboxCtrl.onSend()}"/>
                <p:remoteCommand name="processOnDeleteSelected" process="@form"
                                 update=":mainForm" action="#{mailboxCtrl.onRemoveSelected()}"/>
                <p:remoteCommand name="processOnArchiveSelected" process="@form"
                                 update=":mainForm"
                                 action="#{mailboxCtrl.onArchiveSelected()}"/>
            </h:form>

            <h:outputScript id="dynaFormScript" target="body">
                /* <![CDATA[ */
                $(function () {
                    //Add text editor
                    $("#compose-textarea").wysihtml5();
                });
                function handleComplete(xhr, status, args) {
                    if (args && args.isValid) {
                        PF('inputValuesWidget').show();
                    } else {
                        PF('inputValuesWidget').hide();
                    }
                }

                /* ]]> */
            </h:outputScript>

            <h:outputStylesheet id="dynaFormCSS">

                .pe-dynaform-cell input,
                .pe-dynaform-cell textarea,
                .pe-dynaform-cell[colspan="1"] input,
                .pe-dynaform-cell[colspan="1"] textarea {
                    width: 100%;
                }

                .pe-dynaform-cell.calendar input,
                .pe-dynaform-cell[colspan="1"].calendar input {
                    width: 120px;
                }

                .pe-dynaform-cell.select .ui-selectonemenu {
                    width: 157px !important;
                }

                .pe-dynaform-cell.select .ui-selectonemenu .ui-selectonemenu-label {
                    width: 230px !important;
                }

                .pe-dynaform-cell.separator {
                    padding: 10px 0 10px 0;
                }

                .pe-dynaform-cell.separator .separatorText {
                    width: 15%;
                    padding-left: 0;
                }

                .nopadding {
                    padding: 0 !important;
                    border-style: none !important;
                }
            </h:outputStylesheet>

        </ui:define>


    </ui:composition>


</h:body>

</html>
