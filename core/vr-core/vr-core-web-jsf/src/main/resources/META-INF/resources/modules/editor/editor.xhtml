<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.

and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core"
      >

    <h:head>
        <script>
            function vpcdoit() {
                processOnUpdate();
            }

        </script>
    </h:head>

    <h:body>
        <!--@elvariable id="vr" type="net.thevpc.app.vainruling.core.web.jsf.Vr"-->
        <!--@elvariable id="editorCtrl" type="net.thevpc.app.vainruling.core.web.jsf.ctrl.EditorCtrl"-->


        <ui:composition template="#{vr.privateTemplatePath}">
            <ui:define name="content">
                <h:form id="listForm">
                    <p:confirmDialog message="Etes vous sur de vouloir ne rien faire ?" header="Dummy"
                                     widgetVar="confirmationDummy">
                        <p:commandButton value="Oui en effet" onclick="PF('confirmationDummy').hide();"/>
                        <p:commandButton value="Non" onclick="PF('confirmationDummy').hide()" type="button"/>
                    </p:confirmDialog>
                    <p:confirmDialog message="Etes vous sur de vouloir supprimer la selection ?" header="Suppression"
                                     widgetVar="confirmationDelete">
                        <p:commandButton value="Oui en effet" onclick="PF('confirmationDelete').hide();
                                processOnDeleteCurrent();"/>
                        <p:commandButton value="Non" onclick="PF('confirmationDelete').hide()" type="button"/>
                    </p:confirmDialog>
                    <p:confirmDialog message="Etes vous sur de vouloir archiver la selection ?" header="Archivage"
                                     widgetVar="confirmationArchive">
                        <p:commandButton value="Oui En Effet" onclick="PF('confirmationArchive').hide();
                                processOnArchiveCurrent();"/>
                        <p:commandButton value="Non" onclick="PF('confirmationArchive').hide()" type="button"/>
                    </p:confirmDialog>

                    <!-- /.row -->
                    <h:panelGroup layout="block" id="buttons" styleClass="btn-group">
                        <p:commandButton title="Actualiser" rendered="#{editorCtrl.isEnabledButton('Refresh')}"
                                         icon="fa fa-refresh"
                                         styleClass="btn btn-default"
                                         ajax="true"
                                         actionListener="#{editorCtrl.onRefreshCurrent}"
                                         update=" :listForm  :pageTitleForm" alt=""
                                         value="Actualiser"
                                         />

                        <h:panelGroup layout="block" styleClass="btn-group" rendered="#{editorCtrl.isEnabledButton('Save')}">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="height: 40px;">
                                Enregistrer
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><p:commandLink 
                                        value="#{editorCtrl.bulkUpdateMode ?'Tout Mettre à jour': editorCtrl.updateMode ? 'Mettre à jour':'Enregistrer'}" 
                                        title ="#{editorCtrl.bulkUpdateMode ?'Tout Mettre à jour': editorCtrl.updateMode ? 'Mettre à jour':'Enregistrer'}"
                                        onclick="processOnSaveCurrent()" ajax="true"
                                        update=" :listForm  :pageTitleForm" >
                                        <span class="fa fa-save"></span>

                                    </p:commandLink></li>

                                <ui:fragment rendered="#{editorCtrl.updateMode}">
                                    <li><p:commandLink value="Enregisrer + Fermer" title ="Enregisrer puis Fermer"  onclick="processOnSaveCurrentAndClose()"
                                                       ajax="true" update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-window-close"></span>

                                        </p:commandLink></li>
                                </ui:fragment>
                                <ui:fragment rendered="#{editorCtrl.updateMode}">
                                    <li><p:commandLink value="Enregisrer + Suivant" title ="Enregisrer puis passer au Suivant"  onclick="processOnSaveCurrentAndNext()"
                                                       ajax="true" update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-angle-right"></span>

                                        </p:commandLink></li>
                                </ui:fragment>

                                <ui:fragment rendered="#{editorCtrl.updateMode}">
                                    <li><p:commandLink value="Enregisrer + Précédent" title ="Enregisrer puis passer au Précédent"  onclick="processOnSaveCurrentAndPrevious()"
                                                       ajax="true" update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-angle-left"></span>

                                        </p:commandLink></li>
                                </ui:fragment>

                                <ui:fragment rendered="#{editorCtrl.updateMode}">
                                    <li><p:commandLink value="Enregitrer Copie" title ="Enregister une Copie"  onclick="processOnCloneCurrent()"
                                                       ajax="true" update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-clone"></span>

                                        </p:commandLink></li>
                                </ui:fragment>

                            </ul>
                        </h:panelGroup>

                        <p:commandButton title="Nouveau" rendered="#{editorCtrl.isEnabledButton('New')}" icon="fa fa-plus"
                                         styleClass="btn btn-primary"
                                         ajax="true"
                                         actionListener="#{editorCtrl.onNew}"
                                         update=" :listForm  :pageTitleForm"
                                         value="Nouveau"
                                         />
                        <p:commandButton title="Supprimer" rendered="#{editorCtrl.isEnabledButton('Remove')}"
                                         icon="fa fa-trash-o"
                                         styleClass="btn btn-danger"
                                         ajax="true"
                                         onclick="PF('confirmationDelete').show();"
                                         value="Supprimer"
                                         />

                        <h:panelGroup layout="block" styleClass="btn-group" rendered="#{editorCtrl.isEnabledButton('DisplayGroup')}">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="height: 40px;">
                                Affichage
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <ui:fragment rendered="#{editorCtrl.listMode}">
                                    <li><p:commandLink value="Colonnes" title="Sélectionner les colonnes à afficher" icon=""
                                                       onclick="document.getElementById('listForm:processOnSimpleFieldSelectionLink').click();"
                                                       ajax="true" update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-tasks"></span>

                                        </p:commandLink>
                                    </li>

                                    <li><p:commandLink value="Reini. Colonnes" title="Reinitialiser les Colonnes à afficher"  icon="ui-icon-close"
                                                       onclick="processOnClearFieldSelection()" ajax="true"
                                                       update=" :listForm  :pageTitleForm" >
                                            <span class="fa fa-tasks"></span>

                                        </p:commandLink>
                                    </li>
                                    <li class="divider"></li>
                                </ui:fragment>
                            </ul>
                        </h:panelGroup>

                        <h:panelGroup layout="block" styleClass="btn-group"  rendered="#{editorCtrl.isEnabledButton('AdminGroup')}">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="height: 40px;">
                                Administration
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <ui:fragment rendered="#{editorCtrl.isEnabledButton('BulkUpdate')}">
                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('BulkUpdate')}" value="Mise à jour par lot"
                                                       title="Mise à jour par lot"
                                                       ajax="true"
                                                       actionListener="#{editorCtrl.onBulkUpdate}"
                                                       update=" :listForm  :pageTitleForm"
                                                       >
                                            <span class="fa fa-file-industry"></span>

                                        </p:commandLink>
                                    </li>
                                </ui:fragment>
                                <ui:fragment rendered="#{editorCtrl.updateMode or editorCtrl.listMode}">
                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('Archive')}" value="Archiver"
                                                       onclick="PF('confirmationArchive').show();" ajax="true" >
                                            <span class="fa fa-file-archive"></span>

                                        </p:commandLink>
                                    </li>
                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('ReCalc')}" value="Calculer Sélection" title="Reclaculer les lignes sélectionnées"
                                                       ajax="true"
                                                       actionListener="#{editorCtrl.onReCalcSelection}" >
                                            <span class="fa fa-function"></span>

                                        </p:commandLink></li>
                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('ReCalc')}" value="Enregister Sélection" title="Reenregistrer les lignes sélectionnées"
                                                       ajax="true"
                                                       actionListener="#{editorCtrl.onReSaveSelection}" >
                                            <span class="fa fa-save"></span>

                                        </p:commandLink></li>
                                    <li class="divider"></li>
                                </ui:fragment>
                                <ui:fragment rendered="#{editorCtrl.listMode}">
                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('ReCalc')}" value="Calculer BD" title="Reclaculer Toutes les entités"
                                                       ajax="true"
                                                       actionListener="#{editorCtrl.onReCalcAll}" >
                                            <span class="fa fa-function"></span>

                                        </p:commandLink></li>

                                    <li><p:commandLink rendered="#{editorCtrl.isEnabledButton('ReCalc')}" value="Calculer Entité" title="Reclaculer Toutes les lignes"
                                                       ajax="true"
                                                       actionListener="#{editorCtrl.onReCalcEntity}" >
                                            <span class="fa fa-function"></span>

                                        </p:commandLink></li>

                                </ui:fragment>
                            </ul>
                        </h:panelGroup>

                        <p:commandButton value="Liste" title="Afficher la Liste" rendered="#{editorCtrl.isEnabledButton('List')}"
                                         icon="fa fa-list-ol"
                                         styleClass="btn btn-default" ajax="true"
                                         actionListener="#{editorCtrl.onList}"
                                         update=" :listForm  :pageTitleForm"/>

                        <p:commandButton title="Precédant" icon="fa fa-angle-left"
                                         action="#{editorCtrl.onSelectPrevious}"
                                         rendered="#{editorCtrl.enabledSelectPrevious}"
                                         ajax="true" styleClass="btn btn-default"
                                         update=" :listForm  :pageTitleForm"
                                         />

                        <p:commandButton value="#{editorCtrl.navigateLabel}"
                                         rendered="#{editorCtrl.enabledNavigate}"
                                         styleClass="btn btn-default"
                                         disabled="true"
                                         />

                        <p:commandButton title="Suivant" icon="fa fa-angle-right"
                                         action="#{editorCtrl.onSelectNext}"
                                         rendered="#{editorCtrl.enabledSelectNext}"
                                         ajax="true" styleClass="btn btn-default"
                                         update=" :listForm  :pageTitleForm"
                                         />

                        <h:panelGroup layout="block" styleClass="btn-group" rendered="#{editorCtrl.model.actions.size() gt 0}">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="height: 40px;">
                                Actions
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <ui:repeat value="#{editorCtrl.model.actions}" var="aac">
                                    <li>
                                        <p:commandLink value="#{aac.value}" rendered="#{(aac.type eq 'invoke') or (aac.type eq 'dialog')}"
                                                       process=":listForm :listForm:listTable @form"
                                                       actionListener="#{editorCtrl.openActionDialog(aac.key)}"
                                                       update=" :listForm   :pageTitleForm"
                                                       ajax="true"
                                                       >
                                            <span class="fa fa-#{aac.icon}"></span>
                                        </p:commandLink>
                                        <p:commandLink value="#{aac.value}" rendered="#{(aac.type eq 'goto')}"
                                                       title="#{aac.description}"
                                                       process=":listForm:listTable @form"
                                                       action="#{vr.gotoPage(aac.command[0],aac.command[1])}"
                                                       ajax="true"
                                                       />

                                    </li>
                                </ui:repeat>
                            </ul>
                        </h:panelGroup>

                        <!-- some crazy bug in PF cant help make this work (stackoverflow in dynaform) -->
                        <!--                        <ui:repeat value="#_{editorCtrl.model.actions}" var="aac">
                                                    <p:commandButton value="#_{aac.value}" rendered="#_{(aac.type eq 'invoke') or (aac.type eq 'dialog')}"
                                                                     styleClass="btn btn-default"
                                                                     process=":listForm :listForm:listTable @form"
                                                                     actionListener="#_{editorCtrl.openActionDialog(aac.key)}"
                                                                     update=" :listForm   :pageTitleForm"/>
                                                    <p:commandButton value="#_{aac.value}" rendered="#_{(aac.type eq 'goto')}"
                                                                     title="#_{aac.description}"
                                                                     styleClass="btn btn-default"
                                                                     process=":listForm:listTable @form"
                                                                     action="#_{vr.gotoPage(aac.command[0],aac.command[1])}"
                                                                     />
                                                </ui:repeat>-->
                        <!-- -->

                    </h:panelGroup>
                    <div>
                        <p:spacer width="10" height="10"/>
                    </div>

                    <p:growl id="growl" showDetail="true" sticky="true"/>

                    <h:panelGroup layout="block" styleClass="box box-primary" rendered="#{editorCtrl.isListMode()}">
                        <div class="box-header with-border">
                            <h3 class="box-title">Liste</h3>
                            <h:panelGroup layout="block" rendered="#{(editorCtrl.autoFilters.size() gt 0)}">
                                <ui:repeat value="#{vr.groupListBy(3,editorCtrl.autoFilters)}" var="autoFilterList">
                                    <div class="row">
                                        <ui:repeat value="#{autoFilterList}" var="autoFilter">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <p:outputLabel value="#{autoFilter.data.label}" autofocus="autofocus"/>
                                                    <p:selectOneMenu value="#{autoFilter.selectedString}"
                                                                     filter="true" filterMatchMode="contains"
                                                                     styleClass="form-control"
                                                                     >
                                                        <p:ajax listener="#{editorCtrl.onAutoFilterChange}" update=":listForm"/>
                                                        <f:selectItems value="#{autoFilter.values}"/>
                                                    </p:selectOneMenu>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </ui:repeat>
                            </h:panelGroup>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <div class="box-body">
                            <p:outputPanel id="editItemList" rendered="#{editorCtrl.isListMode()}">
                                <div class="input-group input-group" style="margin-bottom: 10px;">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="height: 34px;">
                                            <p:outputLabel id="selectedSearchId" value="#{editorCtrl.selectedSearch.name}" style="font-size: 10px;"/>
                                            <span class="fa fa-caret-down" style="font-size: 13px;"></span></button>
                                        <ul class="dropdown-menu">
                                            <ui:repeat value="#{editorCtrl.model.searchs}" var="s">
                                                <li> <p:commandLink action="#{editorCtrl.updateSearchType(s.id)}" value="#{s.title}" update=":listForm:selectedSearchId"/>
                                                </li>
                                            </ui:repeat>
                                        </ul>
                                    </div>
                                    <!-- /btn-group -->
                                    <p:inputText
                                        title="#{editorCtrl.model.searchHelper}"
                                        value="#{editorCtrl.model.searchText}" placeholder="Chercher..." styleClass="form-control"
                                        style="width: 100%"
                                        onkeypress="if (event.keyCode == 13) {
                                                    onSearchByText();
                                                    return false;
                                                }"
                                        />
                                    <p:remoteCommand name="onSearchByText" actionListener="#{editorCtrl.onAutoFilterChange}"
                                                     update=":listForm"/>
                                </div>

                                <div>
                                    <!--<div class="col-lg-6">-->

                                    <div class="table-responsive">
                                        <p:dataTable id="listTable" var="i" value="#{editorCtrl.model.list}" 
                                                     class="table table-bordered table-hover"
                                                     paginatorAlwaysVisible="false"
                                                     paginator="true"
                                                     paginatorPosition="bottom"
                                                     rows="100"
                                                     emptyMessage="Aucun résultat"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     rowsPerPageTemplate="20,50,100,200,1000,5000"
                                                     rowStyleClass="#{editorCtrl.rowStyle}"
                                                     selection="#{editorCtrl.model.selectedRows}"
                                                     rowKey="#{i.strId}"
                                                     selectionMode="multiple"
                                                     >

                                            <!--                                    <f:facet name="header">
                                                                                    List
                                                                                    <p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
                                                                                    <p:columnToggler datasource="cars" trigger="toggler" />
                                                                                </f:facet>-->


                                            <p:column exportable="false" headerText=""
                                                      style="width: #{editorCtrl.customCheckboxSelection?'60':'30'}px;">
                                                <p:selectBooleanCheckbox
                                                    rendered="#{editorCtrl.customCheckboxSelection and editorCtrl.isEnabledButton('Select')}"
                                                    disabled="#{!(i.selectable)}" value="#{i.selected}">
                                                </p:selectBooleanCheckbox>
                                                <p:commandLink
                                                    disabled="#{!(i.read)}"
                                                    ajax="true" actionListener="#{editorCtrl.onSelect(i)}"
                                                    update=":listForm   :pageTitleForm">
                                                    <i class="fa fa-pencil-square-o"
                                                       style="font-size: 17px; color: var(--vr-color-main14);"></i>
                                                    <f:setPropertyActionListener target="#{editorCtrl.model.current}" value="#{i}"/>
                                                </p:commandLink>
                                            </p:column>

                                            <p:column exportable="false" headerText="" style="width: 65px;"
                                                      rendered="#{editorCtrl.enabledMainPhoto}">
                                                <img src="#{vr.url(editorCtrl.getMainIcon(i))}"
                                                     style="width: 40px ; height: 40px; margin-right: 10px;"
                                                     alt="Image"
                                                     onclick="document.getElementById('mainPhotoImg').src = '#{vr.url(editorCtrl.getMainPhoto(i))}';
                                                             $('#' + PF('photodlg').id).find('.ui-dialog-title')[0].textContent = '#{editorCtrl.getMainName(i)}';
                                                             PF('photodlg').show();"/>
                                            </p:column>

                                            <!--                                               filterBy="# {i[column.property]}"
                                                                                           filterFunction="# {editorCtrl.filterByProperty}"-->
                                            <p:columns value="#{editorCtrl.columns}"
                                                       var="column" columnIndexVar="colIndex"
                                                       sortBy="#{editorCtrl.getSortLayoutPropertyValue(i.document,column.property)}"
                                                       style="#{editorCtrl.getPropertyColumnStyle(column.property,i)}"
                                                       styleClass="#{editorCtrl.getPropertyColumnStyleClass(column.property,i)}"
                                                       >
                                                <f:facet name="header">
                                                    <h:outputText value="#{column.header}"/>
                                                </f:facet>
                                                <h:outputText rendered="#{column.type eq 'text'}"
                                                              value="#{editorCtrl.getLayoutPropertyValue(i.document,column.property)}"/>
                                                <h:graphicImage rendered="#{column.type eq 'image'}"
                                                                name="#{vr.url(editorCtrl.getLayoutPropertyValue(i.document,column.property))}"
                                                                style="width: 40px ; height: 40px; margin-right: 10px;"
                                                                alt="Image"
                                                                onclick="document.getElementById('mainPhotoImg').src = '#{vr.url(editorCtrl.getMainPhoto(i))}';
                                                                        PF('photodlg').show();"/>

                                                <h:selectBooleanCheckbox rendered="#{column.type eq 'checkbox'}" disabled="true"
                                                                         value="#{editorCtrl.getLayoutPropertyValue(i.document,column.property)}"/>
                                            </p:columns>
                                            <f:facet name="footer">
                                                <p:outputLabel value="Total #{editorCtrl.model.list.size()}"/>

                                                <div style="float: right;">
                                                    <h:commandLink>
                                                        <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-xls16.png"
                                                                        width="16"/>
                                                        <p:dataExporter type="xls" target="listTable"
                                                                        fileName="#{editorCtrl.preferredExportFileName}"
                                                                        postProcessor="#{vr.postProcessDataExporterXLS}"/>
                                                    </h:commandLink>

                                                    <h:commandLink>
                                                        <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-pdf16.png"
                                                                        width="16"/>
                                                        <p:dataExporter type="pdf" target="listTable"
                                                                        fileName="#{editorCtrl.preferredExportFileName}"/>
                                                    </h:commandLink>

                                                    <h:commandLink>
                                                        <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-csv16.png"
                                                                        width="16"/>
                                                        <p:dataExporter type="csv" target="listTable"
                                                                        fileName="#{editorCtrl.preferredExportFileName}"/>
                                                    </h:commandLink>

                                                    <h:commandLink>
                                                        <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-xml16.png"
                                                                        width="16"/>
                                                        <p:dataExporter type="xml" target="listTable"
                                                                        fileName="#{editorCtrl.preferredExportFileName}"/>
                                                    </h:commandLink>
                                                </div>
                                            </f:facet>
                                        </p:dataTable>
                                        <!--                                        <p:contextMenu id="contextMenu4ListTable" for=":listForm:listTable">
                                                                                    <p:menuitem value="View" icon="ui-icon-search" oncomplete="PF('carDialog').show()"/>
                                                                                    <p:menuitem value="Delete" icon="ui-icon-close" oncomplete="PF('carDialog').show()"/>
                                                                                </p:contextMenu>-->
                                    </div>

                                </div>
                                <!-- /.row -->
                            </p:outputPanel>
                        </div>
                        <!-- /.box-body -->

                        <div class="box-footer">
                        </div>
                    </h:panelGroup>



                    <p:remoteCommand name="processOnDeleteCurrent" process="@form"
                                     update=":listForm   " action="#{editorCtrl.onDeleteCurrent()}"/>
                    <p:remoteCommand name="processOnArchiveCurrent" process="@form"
                                     update=":listForm   " action="#{editorCtrl.onArchiveCurrent()}"/>
                    <p:remoteCommand name="processOnSimpleSearch" process="@form" update=":listForm   "
                                     action="#{editorCtrl.onSimpleSearch()}"/>
                    <p:remoteCommand name="processOnClearSearch" process="@form" update=":listForm   "
                                     action="#{editorCtrl.onClearSearch()}"/>
                    <p:remoteCommand name="processOnSimpleFieldSelection" process="@form"
                                     update=":listForm   "
                                     action="#{editorCtrl.onSimpleFieldSelection()}"/>
                    <p:remoteCommand name="processOnClearFieldSelection" process="@form"
                                     update=":listForm   "
                                     action="#{editorCtrl.onClearFieldSelection()}"/>

                    <p:remoteCommand name="processOnUpdate" process="@form" update=":listForm   "
                                     action="#{editorCtrl.onDoNothing()}"/>

                    <p:commandLink id="processOnSimpleSearchLink" action="#{editorCtrl.onSimpleSearch()}"
                                   update=" :listForm   :pageTitleForm">
                        <p:ajax event="dialogReturn" listener="#{editorCtrl.onSearchDialogClosed}" update=":listForm"/>
                    </p:commandLink>
                    <p:commandLink id="processOnAutoFilterLink" action="#{editorCtrl.onAutoFilterChange()}"
                                   update=" :listForm   :pageTitleForm">
                    </p:commandLink>
                    <p:commandLink id="processOnSimpleFieldSelectionLink" action="#{editorCtrl.onSimpleFieldSelection()}"
                                   update=" :listForm   :pageTitleForm">
                        <p:ajax event="dialogReturn" listener="#{editorCtrl.onSearchDialogClosed}" update=":listForm"/>
                    </p:commandLink>


                    <p:commandButton style="display: none" id="processOpenActionDialog0"
                                     action="#{editorCtrl.openActionDialog(editorCtrl.model.actions.get(0).key)}"
                                     update=" :listForm   :pageTitleForm"
                                     >
                        <p:ajax event="dialogReturn" listener="#{editorCtrl.onActionDialogClosed}"
                                update=" :listForm   :pageTitleForm"/>
                    </p:commandButton>

                    <div>
                        <p:spacer width="10" height="10"/>
                    </div>

                    <h:panelGroup layout="block" styleClass="box box-primary"  rendered="#{editorCtrl.isNewOrUpdateMode()}">
                        <div class="box-header with-border">
                            <h3 class="box-title">#{editorCtrl.isNewMode()?'Nouveau':'Edition'}</h3>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <h:panelGroup layout="block" styleClass="box-body" id="editItemDialog">
                            <!--<p:outputPanel id="editItemDialog" >-->
                            <!--                        width="570"
                            height="450"-->
                            <h:panelGroup id="dynaFormGroup">
                                <div class="panel-body">
                                    <pe:dynaForm id="dynaForm" value="#{editorCtrl.dynModel}" var="data">
                                        <pe:dynaFormControl type="text" for="txt" >
                                            <p:inputText id="txt" value="#{data.value}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="integer" for="tinteger" >
                                            <p:inputText id="tinteger" value="#{data.valueInteger}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="long" for="tlong" >
                                            <p:inputText id="tlong" value="#{data.valueLong}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="double" for="tdouble" >
                                            <p:inputText id="tdouble" value="#{data.valueDouble}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="float" for="tfloat" >
                                            <p:inputText id="tfloat" value="#{data.valueFloat}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="datetime" for="tdatetime" styleClass="calendar" >
                                            <p:calendar id="tdatetime" value="#{data.value}"
                                                        required="#{data.required}"
                                                        showOn="button"
                                                        disabled="#{data.disabled}"
                                                        pattern="dd/MM/yyyy HH:mm:ss"
                                                        mask="true"
                                                        />
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="date" for="tdate" styleClass="calendar" >
                                            <p:calendar id="tdate" value="#{data.value}"
                                                        required="#{data.required}"
                                                        showOn="button"
                                                        disabled="#{data.disabled}"
                                                        pattern="dd/MM/yyyy"
                                                        mask="true"
                                                        />
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="time" for="ttime" styleClass="calendar" >
                                            <p:calendar id="ttime" value="#{data.value}"
                                                        required="#{data.required}"
                                                        showOn="button"
                                                        disabled="#{data.disabled}"
                                                        pattern="HH:mm"
                                                        timeOnly="true"
                                                        mask="true"
                                                        />
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="select" for="tselect" styleClass="select" >
                                            <p:selectOneMenu id="tselect" value="#{data.selectedItem}"
                                                             required="#{data.required}"
                                                             disabled="#{data.disabled}"
                                                             filter="true" filterMatchMode="contains"
                                                             >
                                                <f:selectItems value="#{data.items}"/>
                                            </p:selectOneMenu>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="select_onchange" for="tselect_onchange" styleClass="select" >
                                            <p:selectOneMenu id="tselect_onchange" value="#{data.selectedItem}"
                                                             required="#{data.required}"
                                                             disabled="#{data.disabled}"
                                                             valueChangeListener="#{data.onChange}"
                                                             filter="true" filterMatchMode="contains"

                                                             >
                                                <f:selectItems value="#{data.items}"/>
                                                <f:ajax process="@this"  render="editItemDialog" />
                                            </p:selectOneMenu>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="entity" for="tentity" styleClass="select" >
                                            <p:panelGrid columns="2" style="border-style: hidden;width: 100%;"
                                                         columnClasses="multi-component-main,multi-component-action">
                                                <p:selectOneMenu id="tentity" value="#{data.selectedItem}"
                                                                 required="#{data.required}"
                                                                 disabled="#{data.disabled}"
                                                                 styleClass="full-width"
                                                                 filter="true" filterMatchMode="contains"
                                                                 >
                                                    <f:selectItems value="#{data.items}"/>
                                                </p:selectOneMenu>
                                                <p:commandButton
                                                    styleClass="btn btn-primary"
                                                    style="width: 40px;height: 30px;"
                                                    ajax="false" value=""
                                                    icon="fa fa-eye vr-form-button-icon-only"
                                                    disabled="#{data.disabledNavigation}"
                                                    action="#{vr.gotoEditor(data.buildActionCommand())}"/>
                                            </p:panelGrid>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="entity_onchange" for="tentity_onchange" styleClass="select" >
                                            <p:panelGrid columns="2" style="border-style: hidden"
                                                         columnClasses="multi-component-main,multi-component-action">
                                                <p:selectOneMenu id="tentity_onchange" value="#{data.selectedItem}"
                                                                 required="#{data.required}"
                                                                 disabled="#{data.disabled}"
                                                                 valueChangeListener="#{data.onChange}"
                                                                 onchange="submit();"
                                                                 filter="true" filterMatchMode="contains"
                                                                 >
                                                    <f:selectItems value="#{data.items}"/>
                                                </p:selectOneMenu>
                                                <p:commandButton
                                                    styleClass="vr-form-dropdown-button"
                                                    ajax="false" value=""
                                                    icon="fa fa-eye vr-form-button-icon-only"
                                                    disabled="#{data.disabledNavigation}"
                                                    action="#{vr.gotoEditor(data.buildActionCommand())}"/>
                                            </p:panelGrid>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="textarea" for="tarea" >
                                            <p:inputTextarea id="tarea" value="#{data.value}" required="#{data.required}"
                                                             autoResize="false" disabled="#{data.disabled}"
                                                             styleClass="form-control"/>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="richtextarea" for="trichtextarea" >
                                            <p:textEditor 
                                                id="trichtextarea" value="#{data.value}" required="#{data.required}"
                                                readonly="#{data.disabled}"/>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="wikitextarea" for="twikiarea" >
                                            <p:panelGrid style="border-style: hidden;width: 100%"
                                                         columnClasses="nopadding,nopadding">
                                                <p:row>
                                                    <p:column>
                                                        <p:commandButton value="..."
                                                                         action="#{editorCtrl.switchWikiTextArea(data)}"
                                                                         update=":listForm"/>
                                                        <h:outputLink target="_blank"
                                                                      value="https://www.mediawiki.org/wiki/Help:Formatting">help?</h:outputLink>
                                                    </p:column>
                                                </p:row>
                                                <p:row rendered="#{'Edit'.equals(data.componentState)}">
                                                    <p:column>
                                                        <p:inputTextarea id="twikiarea"
                                                                         value="#{data.value}" required="#{data.required}"
                                                                         autoResize="false" disabled="#{data.disabled}"
                                                                         styleClass="form-control"/>
                                                    </p:column>
                                                </p:row>
                                                <p:row rendered="#{!('Edit'.equals(data.componentState))}">
                                                    <p:column>
                                                        <p:scrollPanel style="width:100%;height:200px" id="twikiareaRender"
                                                                       >
                                                            <p:outputLabel
                                                                value="#{vr.wiki2Html(data.value)}"
                                                                escape="false"
                                                                >
                                                            </p:outputLabel>

                                                        </p:scrollPanel>
                                                    </p:column>
                                                </p:row>
                                            </p:panelGrid>

                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="checkbox" for="tcheckbox" >
                                            <p:selectBooleanCheckbox id="tcheckbox" value="#{data.value}"
                                                                     required="#{data.required}" disabled="#{data.disabled}"/>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="rating" for="rat" >
                                            <p:rating id="rat" value="#{data.value}" required="#{data.required}"
                                                      disabled="#{data.disabled}"/>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="separator" styleClass="separator ui-state-disabled" >
                                            <h:panelGrid columns="2" style="width:100%;" columnClasses="separatorText">
                                                <h3>#{data.value}</h3>
                                                <p:separator/>
                                            </h:panelGrid>
                                        </pe:dynaFormControl>
                                        <pe:dynaFormControl type="label"  >
                                            <p:selectBooleanCheckbox value="#{data.bulkSelected}" itemLabel="#{data.value}" 
                                                                     rendered="#{editorCtrl.bulkUpdateMode}"
                                                                     disabled="#{data.disabled}"
                                                                     />
                                            <p:outputLabel value="#{data.value}" rendered="#{!editorCtrl.bulkUpdateMode}"/>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="entityDetail">
                                            <p:commandButton ajax="false" value="#{data.count}" styleClass="btn #{data.count gt 0 ? 'btn-primary':'btn-default'}" 
                                                             disabled="#{data.disabled}"
                                                             action="#{vr.gotoEditor(data.buildActionCommand())}"/>
                                        </pe:dynaFormControl>


                                        <!--<pe:dynaFormControl type="profileExpr" for="tprofileexpr" styleClass="select">-->
                                        <!--<p:panelGrid columns="2" style="border-style: hidden"-->
                                        <!--columnClasses="nopadding,nopadding">-->

                                        <!--<p:inputText id="tprofileexpr" value="#_{data.value}" required="#_{data.required}"-->
                                        <!--disabled="#_{data.disabled}" styleClass="form-control"/>-->
                                        <!--<p:commandButton-->
                                        <!--style="padding-top: 8px; margin-bottom: 3px; margin-left: 1px; padding-bottom: 8px;"-->
                                        <!--ajax="true" value=""-->
                                        <!--icon="fa fa-users"-->
                                        <!--actionListener="#_{editorCtrl.openPropertyViewDialog(data.componentId,'')}"-->
                                        <!--&gt;-->
                                        <!--<p:ajax event="dialogReturn"-->
                                        <!--listener="#_{editorCtrl.onPropertyViewDialogClosed}"-->
                                        <!--update="tprofileexpr"/>-->

                                        <!--</p:commandButton>-->
                                        <!--</p:panelGrid>-->
                                        <!--</pe:dynaFormControl>-->

                                        <pe:dynaFormControl type="profileExpr" for="tprofileexpr" styleClass="select" >
                                            <div class="form-group">
                                                <p:autoComplete id="tprofileexpr"
                                                                styleClass="vr-form-control vr-form-control-with-button60"
                                                                placeholder="" value="#{data.value}"
                                                                completeMethod="#{vr.autoCompleteProfileExpression}"
                                                                queryDelay="1000"
                                                                disabled="#{data.disabled}"
                                                                >
                                                    <p:ajax event="blur" listener="#{vr.updateProfileExpressionUsersCount}"
                                                            process="@this"
                                                            update="btnto"/>
                                                </p:autoComplete>
                                                <p:commandButton
                                                    id="btnto"
                                                    styleClass="vr-form-control-right-button60"
                                                    ajax="true" value="#{data.hint}"
                                                    icon="fa fa-users"
                                                    actionListener="#{editorCtrl.openPropertyViewDialog(data.componentId,'')}"
                                                    >
                                                    <p:ajax event="dialogReturn"
                                                            listener="#{editorCtrl.onPropertyViewDialogClosed}"
                                                            update="tprofileexpr"/>
                                                </p:commandButton>
                                            </div>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="discipline" for="tdiscipline" styleClass="select" >
                                            <p:panelGrid columns="2" style="border-style: hidden"
                                                         columnClasses="nopadding,nopadding">

                                                <p:inputText id="tdiscipline" value="#{data.value}" required="#{data.required}"
                                                             disabled="#{data.disabled}" styleClass="form-control"/>
                                                <p:commandButton
                                                    style="padding-top: 8px; margin-bottom: 3px; margin-left: 1px; padding-bottom: 8px;"
                                                    ajax="true" value=""
                                                    icon="fa fa-tags"
                                                    actionListener="#{editorCtrl.openPropertyViewDialog(data.componentId,'')}"
                                                    >
                                                    <p:ajax event="dialogReturn"
                                                            listener="#{editorCtrl.onPropertyViewDialogClosed}"
                                                            update="tdiscipline"/>

                                                </p:commandButton>
                                            </p:panelGrid>
                                        </pe:dynaFormControl>

                                        <pe:dynaFormControl type="file" for="tfile" styleClass="select" >
                                            <div class="form-group">

                                                <p:inputText id="tfile" value="#{data.value}" required="#{data.required}"
                                                             disabled="#{data.disabled}"
                                                             styleClass="form-control vr-form-control vr-form-control-with-button60"/>
                                                <p:commandLink
                                                    rendered="#{vr.isFSPath(vr.trim(data.value))}"
                                                    target="_blank"
                                                    value="..."
                                                    styleClass="btn  btn-default vr-form-control-right-button30"
                                                    style="margin-left: 3px;margin-right: 3px;margin-top: 5px;"
                                                    ajax="false"
                                                    >
                                                    <p:fileDownload value="#{vr.downloadPath(vr.trim(data.value))}"/>
                                                </p:commandLink>

                                                <p:commandButton
                                                    styleClass="vr-form-control-right-button30"
                                                    ajax="true" value=""
                                                    icon="fa fa-folder-open-o"
                                                    title="Mes Documents"
                                                    actionListener="#{editorCtrl.openPropertyViewDialog(data.componentId,'folder')}"
                                                    >
                                                    <p:ajax event="dialogReturn"
                                                            listener="#{editorCtrl.onPropertyViewDialogClosed}" update="tfile"/>

                                                </p:commandButton>
                                                <p:commandButton
                                                    styleClass="vr-form-control-right-button30"
                                                    ajax="true" value=""
                                                    icon="fa fa-cloud-upload"
                                                    title="Téléverser"
                                                    actionListener="#{editorCtrl.openPropertyViewDialog(data.componentId,'upload')}"
                                                    >
                                                    <p:ajax event="dialogReturn"
                                                            listener="#{editorCtrl.onPropertyViewDialogClosed}" update="tfile"/>

                                                </p:commandButton>
                                            </div>
                                        </pe:dynaFormControl>


                                    </pe:dynaForm>
                                </div>
                            </h:panelGroup>
                        </h:panelGroup>

                    </h:panelGroup>
                    <!-- /.box-body -->

                    <div class="box-footer">
                    </div>

                    <p:remoteCommand name="processOnSaveCurrentAndClose" process="@form"
                                     update=":listForm   "
                                     action="#{editorCtrl.onSaveCurrentAndClose()}"/>
                    <p:remoteCommand name="processOnSaveCurrentAndNext" process="@form"
                                     update=":listForm   "
                                     action="#{editorCtrl.onSaveCurrentAndNext()}"/>
                    <p:remoteCommand name="processOnSaveCurrentAndPrevious" process="@form"
                                     update=":listForm   "
                                     action="#{editorCtrl.onSaveCurrentAndPrevious()}"/>
                    <p:remoteCommand name="processOnSaveCurrent" process="@form" update=":listForm   "
                                     action="#{editorCtrl.onSaveCurrent()}"/>
                    <p:remoteCommand name="processOnCloneCurrent" process="@form" update=":listForm   "
                                     action="#{editorCtrl.onCloneCurrent()}"/>
                </h:form>

                <h:outputScript id="dynaFormScript" target="body">
                    /* <![CDATA[ */
                    function handleComplete(xhr, status, args) {
                    if (args && args.isValid) {
                    PF('inputValuesWidget').show();
                    } else {
                    PF('inputValuesWidget').hide();
                    }
                    }

                    /* ]]> */
                </h:outputScript>

                <p:dialog header="Photo" widgetVar="photodlg" modal="true" height="400">
                    <img id="mainPhotoImg" src=""
                         style="width: 400px ; height: 400px; margin-right: 10px;"
                         alt="Image"/>
                </p:dialog>
            </ui:define>


        </ui:composition>


    </h:body>

</html>
