<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.

and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core"
      >

    <h:head>
        <script>
            function vpcdoit() {
                processOnUpdate();
            }

        </script>
    </h:head>

    <h:body>
        <!--@elvariable id="vr" type="net.vpc.app.vainruling.core.web.jsf.Vr"-->
        <!--@elvariable id="objCtrl" type="net.vpc.app.vainruling.core.web.jsf.ctrl.ObjCtrl"-->


        <ui:composition template="#{vr.privateTemplatePath}">
            <ui:define name="content">
                <h:form id="listForm">
                    <p:confirmDialog message="Etes vous sur de vouloir supprimer la selection ?" header="Suppression"
                                     widgetVar="confirmationDelete">
                        <p:commandButton value="Oui en effet" onclick="PF('confirmationDelete').hide();
                                processOnDeleteCurrent();"/>
                        <p:commandButton value="Non" onclick="PF('confirmationDelete').hide()" type="button"/>
                    </p:confirmDialog>
                    <p:confirmDialog message="Etes vous sur de vouloir archiver la selection ?" header="Archivage"
                                     widgetVar="confirmationArchive">
                        <p:commandButton value="Oui En Effet" onclick="PF('confirmationArchive').hide();
                                processOnArchiveCurrent();"/>
                        <p:commandButton value="Non" onclick="PF('confirmationArchive').hide()" type="button"/>
                    </p:confirmDialog>

                    <!-- /.row -->
                    <div>
                        <p:outputPanel id="buttons">
                            <p:commandButton title="Actualiser" rendered="#{objCtrl.isEnabledButton('Refresh')}"
                                             icon="fa fa-refresh"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button btn btn-default"
                                             ajax="true"
                                             actionListener="#{objCtrl.onRefreshCurrent}"
                                             update=" :listForm  :pageTitleForm" alt=""
                                             value="Actualiser"
                                             />
                            <p:splitButton title="Enregistrer" rendered="#{objCtrl.isEnabledButton('Save')}"
                                           onclick="processOnSaveCurrent()"
                                           update=" :listForm  :pageTitleForm" icon="fa fa-save"
                                           styleClass=" vr-toolbox-split-button "
                                           value="Enregistrer"
                                           >
                                <p:menuitem value="Enregistrer" title ="Enregister"  onclick="processOnSaveCurrent()" ajax="true"
                                            update=" :listForm  :pageTitleForm" icon="ui-icon-close"/>
                                <p:menuitem value="Fermer" title ="Enregister et Fermer"  onclick="processOnSaveCurrentAndClose()"
                                            ajax="true" update=" :listForm  :pageTitleForm"
                                            icon="ui-icon-arrowrefresh-1-w"/>
                                <p:menuitem value="Suivant" title ="Enregister et Fermer"  onclick="processOnSaveCurrentAndNext()"
                                            ajax="true" update=" :listForm  :pageTitleForm"
                                            icon="ui-icon-arrowrefresh-1-w"/>
                                <p:menuitem value="Précédent" title ="Enregister et Fermer"  onclick="processOnSaveCurrentAndPrevious()"
                                            ajax="true" update=" :listForm  :pageTitleForm"
                                            icon="ui-icon-arrowrefresh-1-w"/>
                                <p:menuitem value="Copier" title ="Enregister une Copie"  onclick="processOnCloneCurrent()"
                                            ajax="true" update=" :listForm  :pageTitleForm"
                                            icon="ui-icon-arrowrefresh-1-w"/>
                            </p:splitButton>

                            <p:commandButton title="Nouveau" rendered="#{objCtrl.isEnabledButton('New')}" icon="fa fa-plus"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button btn btn-primary"
                                             ajax="true"
                                             actionListener="#{objCtrl.onNew}"
                                             update=" :listForm  :pageTitleForm"
                                             value="Nouveau"
                                             />

                            <p:commandButton title="Supprimer" rendered="#{objCtrl.isEnabledButton('Remove')}"
                                             icon="fa fa-trash-o"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button btn btn-danger"
                                             ajax="true"
                                             onclick="PF('confirmationDelete').show();"
                                             value="Supprimer"
                                             />

                            <p:splitButton title="Chercher" rendered="#{objCtrl.isEnabledButton('Search')}"
                                           icon="fa fa-search"
                                           onclick="document.getElementById('listForm:processOnSimpleSearchLink').click();"
                                           update=" :listForm  :pageTitleForm"
                                           styleClass=" vr-toolbox-split-button"
                                           value="Chercher"
                                           >
                                <p:menuitem value="Simple Rech." title="Simple Rechercher par mots clés"  icon=""
                                            onclick="document.getElementById('listForm:processOnSimpleSearchLink').click();"
                                            ajax="true" update=" :listForm  :pageTitleForm"/>
                                <p:menuitem value="Annuler Rech." title="Annuler Recherche"  icon="ui-icon-close" onclick="processOnClearSearch()"
                                            ajax="true" update=" :listForm  :pageTitleForm"/>
                                <p:separator/>
                                <p:menuitem value="Propriétés" title="Sélectionner les propriétés à afficher" icon=""
                                            onclick="document.getElementById('listForm:processOnSimpleFieldSelectionLink').click();"
                                            ajax="true" update=" :listForm  :pageTitleForm"/>
                                <p:menuitem value="Reini. Prop." title="Reinitialiser les Propriétés à afficher"  icon="ui-icon-close"
                                            onclick="processOnClearFieldSelection()" ajax="true"
                                            update=" :listForm  :pageTitleForm"/>
                            </p:splitButton>


                            <p:splitButton rendered="#{objCtrl.isEnabledButton('Advanced')}" title="Avancé"
                                           icon="fa fa-compass" styleClass=" vr-toolbox-split-button"
                                           value="Avancé"
                                           >
                                <p:menuitem rendered="#{objCtrl.isEnabledButton('Archive')}" value="Archiver"
                                            icon="fa fa-archive" onclick="PF('confirmationArchive').show();" ajax="true"/>
                                <p:separator/>
                                <p:menuitem rendered="#{objCtrl.isEnabledButton('ReCalc')}" value="Calc." title="Reclaculer les formules"
                                            icon="fa fa-calculator" ajax="true"
                                            actionListener="#{objCtrl.onReCalc}"
                                            />
                                <p:separator/>
                            </p:splitButton>

                            <p:commandButton value="Ann." rendered="#{objCtrl.isEnabledButton('Assign')}"
                                             icon="ui-ribbonicon-canc"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" ajax="true"
                                             actionListener="#{objCtrl.onAssignCurrent}"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Ann." rendered="#{objCtrl.isEnabledButton('Unassign')}"
                                             icon="ui-ribbonicon-canc"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" ajax="true"
                                             actionListener="#{objCtrl.onUnassignCurrent}"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Ann." rendered="#{objCtrl.isEnabledButton('Done')}"
                                             icon="ui-ribbonicon-canc"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" ajax="true"
                                             actionListener="#{objCtrl.onDoneCurrent}"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Ann." rendered="#{objCtrl.isEnabledButton('Verify')}"
                                             icon="ui-ribbonicon-canc"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" ajax="true"
                                             actionListener="#{objCtrl.onVerifyCurrent}"
                                             update=" :listForm  :pageTitleForm"/>

                            <p:commandButton value="Cop." rendered="#{objCtrl.isEnabledButton('Copy')}" icon="fa fa-copy"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Coll." rendered="#{objCtrl.isEnabledButton('Paste')}" icon="fa fa-paste"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Coup." rendered="#{objCtrl.isEnabledButton('Cut')}" icon="fa fa-cut"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>

                            <p:commandButton value="impr." rendered="#{objCtrl.isEnabledButton('Print')}" icon="fa fa-print"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>

                            <p:commandButton value="imp." rendered="#{objCtrl.isEnabledButton('Import')}"
                                             icon="fa fa-cloud-upload"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="csv" rendered="#{objCtrl.isEnabledButton('ExportCSV')}"
                                             icon="fa fa-file-text-o"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="xls" rendered="#{objCtrl.isEnabledButton('ExportXls')}"
                                             icon="fa fa-file-excel-o"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="pdf" rendered="#{objCtrl.isEnabledButton('ExportPdf')}"
                                             icon="fa fa-file-pdf-o"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Auth." rendered="#{objCtrl.isEnabledButton('Authorization')}"
                                             icon="fa fa-user-secret"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" type="button"
                                             update=" :listForm  :pageTitleForm"/>
                            <p:commandButton value="Trace" rendered="#{objCtrl.isEnabledButton('Log')}"
                                             icon="fa fa-backward"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" type="button"
                                             update=" :listForm   :pageTitleForm"/>
                            <p:commandButton value="Liste" title="Afficher la Liste" rendered="#{objCtrl.isEnabledButton('List')}"
                                             icon="fa fa-list-ol"
                                             styleClass="ui-ribbon-bigbutton  vr-toolbox-button" ajax="true"
                                             actionListener="#{objCtrl.onList}"
                                             update=" :listForm  :pageTitleForm"/>

                            <p:commandButton title="Precédant" icon="fa fa-angle-left"
                                             action="#{objCtrl.onSelectPrevious}"
                                             rendered="#{objCtrl.enabledSelectPrevious}"
                                             ajax="true" styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"
                                             />

                            <p:commandButton title="Suivant" icon="fa fa-angle-right"
                                             action="#{objCtrl.onSelectNext}"
                                             rendered="#{objCtrl.enabledSelectNext}"
                                             ajax="true" styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                             update=" :listForm  :pageTitleForm"
                                             />

<!--                            <p:commandButton title="Retour" icon="fa fa-backward"
                                             action="# {vr.goBack}"
                                             ajax="false" styleClass="ui-ribbon-bigbutton  vr-toolbox-button"/>-->


                            <!--                            <p:commandButton
                                                            value="#_{objCtrl.model.actions.get(0).value}"
                                                            rendered="#_{objCtrl.model.actions.size() gt 0 and objCtrl.isEnabledButton(objCtrl.model.actions.get(0).key)}"
                                                            icon="#_{objCtrl.model.actions.get(0).icon}"
                                                            styleClass="ui-ribbon-bigbutton   vr-toolbox-button"
                                                            ajax="true"
                                                            actionListener="#_{objCtrl.openActionDialog(objCtrl.model.actions.get(0).key)}"
                                                            >
                                                            <p:ajax event="dialogReturn" listener="#_{objCtrl.onActionDialogClosed}" update=" :listForm   :pageTitleForm" />
    
                                                        </p:commandButton>-->
<!--                            <p:commandButton
                                value="# {objCtrl.model.actions.get(0).value}"
                                rendered="# {objCtrl.model.actions.size() gt 0 and objCtrl.isEnabledButton(objCtrl.model.actions.get(0).key)}"
                                icon="# {objCtrl.model.actions.get(0).icon}"
                                styleClass="ui-ribbon-bigbutton   vr-toolbox-button"
                                ajax="true"
                                onclick="document.getElementById('listForm:processOpenActionDialog0').click();"
                                >
                            </p:commandButton>

                            <p:commandButton value="# {objCtrl.model.actions.get(1).value}"
                                             rendered="# {objCtrl.model.actions.size() gt 1 and objCtrl.isEnabledButton(objCtrl.model.actions.get(1).key)}"
                                             icon="# {objCtrl.model.actions.get(1).icon}"
                                             styleClass="ui-ribbon-bigbutton   vr-toolbox-button"
                                             ajax="true"
                                             actionListener="# {objCtrl.openActionDialog(objCtrl.model.actions.get(1).key)}"
                                             >
                                <p:ajax event="dialogReturn" listener="# {objCtrl.onActionDialogClosed}"
                                        update=" :listForm   :pageTitleForm"/>
                            </p:commandButton>

                            <p:commandButton value="# {objCtrl.model.actions.get(2).value}"
                                             rendered="# {objCtrl.model.actions.size() gt 2 and objCtrl.isEnabledButton(objCtrl.model.actions.get(2).key)}"
                                             icon="# {objCtrl.model.actions.get(2).icon}"
                                             styleClass="ui-ribbon-bigbutton   vr-toolbox-button"
                                             ajax="true"
                                             actionListener="# {objCtrl.openActionDialog(objCtrl.model.actions.get(2).key)}"
                                             >
                                <p:ajax event="dialogReturn" listener="# {objCtrl.onActionDialogClosed}"
                                        update=" :listForm   :pageTitleForm"/>
                            </p:commandButton>-->

                            <!-- some crazy bug in PF cant help make this work (stackoverflow in dynaform) -->
                            <ui:repeat value="#{objCtrl.model.actions}" var="aac">
                                <p:commandButton value="#{aac.value}" rendered="#{(aac.type eq 'invoke') or (aac.type eq 'dialog')}"
                                                 icon="#{aac.icon}"
                                                 styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                                 process=":listForm :listForm:listTable @form"
                                                 actionListener="#{objCtrl.openActionDialog(aac.key)}"
                                                 update=" :listForm   :pageTitleForm"/>
                                <p:commandButton value="#{aac.value}" rendered="#{(aac.type eq 'goto')}"
                                                 title="#{aac.description}"
                                                 icon="#{aac.icon}"
                                                 styleClass="ui-ribbon-bigbutton  vr-toolbox-button"
                                                 process=":listForm:listTable @form"
                                                 action="#{vr.gotoPage(aac.command[0],aac.command[1])}"
                                                 />
                            </ui:repeat><!-- -->
                        </p:outputPanel>
                    </div>
                    <div>
                        <p:spacer width="10" height="10"/>
                    </div>
                    <p:panelGrid rendered="#{objCtrl.isListMode() and (objCtrl.autoFilters.size() gt 0)}"
                                 styleClass="vr-no-border-grid">
                        <ui:repeat value="#{vr.groupListBy(3,objCtrl.autoFilters)}" var="autoFilterList">
                            <p:row>
                                <ui:repeat value="#{autoFilterList}" var="autoFilter">
                                    <p:column>
                                        <p:outputLabel value="#{autoFilter.data.label}"
                                                       styleClass="vr-form-field vr-form-fixed-width-short"
                                                       autofocus="autofocus"/>
                                        <!--valueChangeListener="#_{objCtrl.onAutoFilterChange}"-->
                                        <!--onchange="document.getElementById('listForm:processOnAutoFilterLink').click();"-->
                                        <p:selectOneMenu value="#{autoFilter.selectedString}" styleClass="vr-form-field"
                                                         filter="true" filterMatchMode="contains"
                                                         >
                                            <p:ajax listener="#{objCtrl.onAutoFilterChange}" update=":listForm"/>
                                            <f:selectItems value="#{autoFilter.values}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                </ui:repeat>
                            </p:row>
                        </ui:repeat>
                    </p:panelGrid>
                    <!-- /.row -->

                    <div style="margin-bottom: 10px;">
                        <p:inputText
                            rendered="#{objCtrl.isListMode()}" title="#{objCtrl.model.searchTextHelper}"
                            value="#{objCtrl.model.searchText}" placeholder="Chercher ..." styleClass="form-control"
                            style="width: 100%"
                            onkeypress="if (event.keyCode == 13) {
                                        onSearchByText();
                                        return false;
                                    }"
                            />
                        <p:remoteCommand name="onSearchByText" actionListener="#{objCtrl.onAutoFilterChange}"
                                         update=":listForm"/>
                    </div>
                    <p:growl id="growl" showDetail="true" sticky="true"/>
                    <p:outputPanel id="editItemList" rendered="#{objCtrl.isListMode()}">
                        <div>
                            <!--<div class="col-lg-6">-->

                            <div class="table-responsive">
                                <p:dataTable id="listTable" var="i" value="#{objCtrl.model.list}"
                                             class="table table-bordered table-hover"
                                             paginatorAlwaysVisible="false"
                                             paginator="true"
                                             paginatorPosition="bottom"
                                             rows="100"
                                             emptyMessage="Aucun résultat"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="20,50,100,200,1000,5000"
                                             rowStyleClass="#{objCtrl.rowStyle}"
                                             selection="#{objCtrl.model.selectedRows}"
                                             rowKey="#{i.strId}"
                                             selectionMode="multiple"
                                             >

                                    <!--                                    <f:facet name="header">
                                                                            List
                                                                            <p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
                                                                            <p:columnToggler datasource="cars" trigger="toggler" />
                                                                        </f:facet>-->


                                    <p:column exportable="false" headerText=""
                                              style="width: #{objCtrl.customCheckboxSelection?'60':'30'}px;">
                                        <p:selectBooleanCheckbox
                                            rendered="#{objCtrl.customCheckboxSelection and objCtrl.isEnabledButton('Select')}"
                                            disabled="#{!(i.selectable)}" value="#{i.selected}">
                                        </p:selectBooleanCheckbox>
                                        <p:commandLink
                                            disabled="#{!(i.read)}"
                                            ajax="true" actionListener="#{objCtrl.onSelect(i)}"
                                            update=":listForm   :pageTitleForm">
                                            <i class="fa fa-pencil-square-o"
                                               style="font-size: 17px; color: var(--vr-color-main14);"></i>
                                            <f:setPropertyActionListener target="#{objCtrl.model.current}" value="#{i}"/>
                                        </p:commandLink>
                                    </p:column>

                                    <p:column exportable="false" headerText="" style="width: 65px;"
                                              rendered="#{objCtrl.enabledMainPhoto}">
                                        <img src="#{vr.url(objCtrl.getMainIcon(i))}"
                                             style="width: 40px ; height: 40px; margin-right: 10px;"
                                             alt="Image"
                                             onclick="document.getElementById('mainPhotoImg').src = '#{vr.url(objCtrl.getMainPhoto(i))}';
                                                     $('#' + PF('photodlg').id).find('.ui-dialog-title')[0].textContent = '#{objCtrl.getMainName(i)}';
                                                     PF('photodlg').show();"/>
                                    </p:column>

                                    <!--                                               filterBy="# {i[column.property]}"
                                                                                   filterFunction="# {objCtrl.filterByProperty}"-->
                                    <p:columns value="#{objCtrl.columns}"
                                               var="column" columnIndexVar="colIndex"
                                               sortBy="#{objCtrl.getSortLayoutPropertyValue(i.document,column.property)}"
                                               style="#{objCtrl.getPropertyColumnStyle(column.property,i)}"
                                               styleClass="#{objCtrl.getPropertyColumnStyleClass(column.property,i)}"
                                               >
                                        <f:facet name="header">
                                            <h:outputText value="#{column.header}"/>
                                        </f:facet>
                                        <h:outputText rendered="#{column.type eq 'text'}"
                                                      value="#{objCtrl.getLayoutPropertyValue(i.document,column.property)}"/>
                                        <h:graphicImage rendered="#{column.type eq 'image'}"
                                                        name="#{vr.url(objCtrl.getLayoutPropertyValue(i.document,column.property))}"
                                                        style="width: 40px ; height: 40px; margin-right: 10px;"
                                                        alt="Image"
                                                        onclick="document.getElementById('mainPhotoImg').src = '#{vr.url(objCtrl.getMainPhoto(i))}';
                                                                PF('photodlg').show();"/>

                                        <h:selectBooleanCheckbox rendered="#{column.type eq 'checkbox'}" disabled="true"
                                                                 value="#{objCtrl.getLayoutPropertyValue(i.document,column.property)}"/>
                                    </p:columns>
                                    <f:facet name="footer">
                                        <p:outputLabel value="Total #{objCtrl.model.list.size()}"/>

                                        <div style="float: right;">
                                            <h:commandLink>
                                                <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-xls16.png"
                                                                width="16"/>
                                                <p:dataExporter type="xls" target="listTable"
                                                                fileName="#{objCtrl.preferredExportFileName}"
                                                                postProcessor="#{vr.postProcessDataExporterXLS}"/>
                                            </h:commandLink>

                                            <h:commandLink>
                                                <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-pdf16.png"
                                                                width="16"/>
                                                <p:dataExporter type="pdf" target="listTable"
                                                                fileName="#{objCtrl.preferredExportFileName}"/>
                                            </h:commandLink>

                                            <h:commandLink>
                                                <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-csv16.png"
                                                                width="16"/>
                                                <p:dataExporter type="csv" target="listTable"
                                                                fileName="#{objCtrl.preferredExportFileName}"/>
                                            </h:commandLink>

                                            <h:commandLink>
                                                <p:graphicImage url="#{vr.privateThemePath}/images/icons/file-xml16.png"
                                                                width="16"/>
                                                <p:dataExporter type="xml" target="listTable"
                                                                fileName="#{objCtrl.preferredExportFileName}"/>
                                            </h:commandLink>
                                        </div>
                                    </f:facet>
                                </p:dataTable>
                                <p:contextMenu id="contextMenu4ListTable" for=":listForm:listTable">
                                    <p:menuitem value="View" icon="ui-icon-search" oncomplete="PF('carDialog').show()"/>
                                    <p:menuitem value="Delete" icon="ui-icon-close" oncomplete="PF('carDialog').show()"/>
                                </p:contextMenu>
                            </div>

                        </div>
                        <!-- /.row -->
                    </p:outputPanel>
                    <p:remoteCommand name="processOnDeleteCurrent" process="@form"
                                     update=":listForm   " action="#{objCtrl.onDeleteCurrent()}"/>
                    <p:remoteCommand name="processOnArchiveCurrent" process="@form"
                                     update=":listForm   " action="#{objCtrl.onArchiveCurrent()}"/>
                    <p:remoteCommand name="processOnSimpleSearch" process="@form" update=":listForm   "
                                     action="#{objCtrl.onSimpleSearch()}"/>
                    <p:remoteCommand name="processOnClearSearch" process="@form" update=":listForm   "
                                     action="#{objCtrl.onClearSearch()}"/>
                    <p:remoteCommand name="processOnSimpleFieldSelection" process="@form"
                                     update=":listForm   "
                                     action="#{objCtrl.onSimpleFieldSelection()}"/>
                    <p:remoteCommand name="processOnClearFieldSelection" process="@form"
                                     update=":listForm   "
                                     action="#{objCtrl.onClearFieldSelection()}"/>

                    <p:remoteCommand name="processOnUpdate" process="@form" update=":listForm   "
                                     action="#{objCtrl.onDoNothing()}"/>

                    <p:commandLink id="processOnSimpleSearchLink" action="#{objCtrl.onSimpleSearch()}"
                                   update=" :listForm   :pageTitleForm">
                        <p:ajax event="dialogReturn" listener="#{objCtrl.onSearchDialogClosed}" update=":listForm"/>
                    </p:commandLink>
                    <p:commandLink id="processOnAutoFilterLink" action="#{objCtrl.onAutoFilterChange()}"
                                   update=" :listForm   :pageTitleForm">
                    </p:commandLink>
                    <p:commandLink id="processOnSimpleFieldSelectionLink" action="#{objCtrl.onSimpleFieldSelection()}"
                                   update=" :listForm   :pageTitleForm">
                        <p:ajax event="dialogReturn" listener="#{objCtrl.onSearchDialogClosed}" update=":listForm"/>
                    </p:commandLink>


                    <p:commandButton style="display: none" id="processOpenActionDialog0"
                                     action="#{objCtrl.openActionDialog(objCtrl.model.actions.get(0).key)}"
                                     update=" :listForm   :pageTitleForm"
                                     >
                        <p:ajax event="dialogReturn" listener="#{objCtrl.onActionDialogClosed}"
                                update=" :listForm   :pageTitleForm"/>
                    </p:commandButton>

                    <div>
                        <p:spacer width="10" height="10"/>
                    </div>
                    <p:outputPanel id="editItemDialog" rendered="#{objCtrl.isNewOrUpdateMode()}">
                        <!--<p:outputPanel id="editItemDialog" >-->
                        <!--                        width="570"
                        height="450"-->
                        <h:panelGroup id="dynaFormGroup">
                            <div class="panel-body">
                                <pe:dynaForm id="dynaForm" value="#{objCtrl.dynModel}" var="data">
                                    <pe:dynaFormControl type="text" for="txt" >
                                        <p:inputText id="txt" value="#{data.value}" required="#{data.required}"
                                                     disabled="#{data.disabled}" styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="integer" for="tinteger" >
                                        <p:inputText id="tinteger" value="#{data.valueInteger}" required="#{data.required}"
                                                     disabled="#{data.disabled}" styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="long" for="tlong" >
                                        <p:inputText id="tlong" value="#{data.valueLong}" required="#{data.required}"
                                                     disabled="#{data.disabled}" styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="double" for="tdouble" >
                                        <p:inputText id="tdouble" value="#{data.valueDouble}" required="#{data.required}"
                                                     disabled="#{data.disabled}" styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="float" for="tfloat" >
                                        <p:inputText id="tfloat" value="#{data.valueFloat}" required="#{data.required}"
                                                     disabled="#{data.disabled}" styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="datetime" for="tdatetime" styleClass="calendar" >
                                        <p:calendar id="tdatetime" value="#{data.value}"
                                                    required="#{data.required}"
                                                    showOn="button"
                                                    disabled="#{data.disabled}"
                                                    pattern="dd/MM/yyyy HH:mm:ss"
                                                    mask="true"
                                                    />
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="date" for="tdate" styleClass="calendar" >
                                        <p:calendar id="tdate" value="#{data.value}"
                                                    required="#{data.required}"
                                                    showOn="button"
                                                    disabled="#{data.disabled}"
                                                    pattern="dd/MM/yyyy"
                                                    mask="true"
                                                    />
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="time" for="ttime" styleClass="calendar" >
                                        <p:calendar id="ttime" value="#{data.value}"
                                                    required="#{data.required}"
                                                    showOn="button"
                                                    disabled="#{data.disabled}"
                                                    pattern="HH:mm"
                                                    timeOnly="true"
                                                    mask="true"
                                                    />
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="select" for="tselect" styleClass="select" >
                                        <p:selectOneMenu id="tselect" value="#{data.selectedItem}"
                                                         required="#{data.required}"
                                                         disabled="#{data.disabled}"
                                                         filter="true" filterMatchMode="contains"
                                                         >
                                            <f:selectItems value="#{data.items}"/>
                                        </p:selectOneMenu>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="select_onchange" for="tselect_onchange" styleClass="select" >
                                        <p:selectOneMenu id="tselect_onchange" value="#{data.selectedItem}"
                                                         required="#{data.required}"
                                                         disabled="#{data.disabled}"
                                                         valueChangeListener="#{data.onChange}"
                                                         filter="true" filterMatchMode="contains"

                                                         >
                                            <f:selectItems value="#{data.items}"/>
                                            <f:ajax process="@this"  render="editItemDialog" />
                                        </p:selectOneMenu>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="entity" for="tentity" styleClass="select" >
                                        <p:panelGrid columns="2" style="border-style: hidden;width: 100%;"
                                                     columnClasses="multi-component-main,multi-component-action">
                                            <p:selectOneMenu id="tentity" value="#{data.selectedItem}"
                                                             required="#{data.required}"
                                                             disabled="#{data.disabled}"
                                                             styleClass="full-width"
                                                             filter="true" filterMatchMode="contains"
                                                             >
                                                <f:selectItems value="#{data.items}"/>
                                            </p:selectOneMenu>
                                            <p:commandButton
                                                styleClass="vr-form-dropdown-button"
                                                ajax="false" value=""
                                                icon="fa fa-eye vr-form-button-icon-only"
                                                disabled="#{data.disabledNavigation}"
                                                action="#{vr.gotoPage('obj', data.buildActionCommand())}"/>
                                        </p:panelGrid>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="entity_onchange" for="tentity_onchange" styleClass="select" >
                                        <p:panelGrid columns="2" style="border-style: hidden"
                                                     columnClasses="multi-component-main,multi-component-action">
                                            <p:selectOneMenu id="tentity_onchange" value="#{data.selectedItem}"
                                                             required="#{data.required}"
                                                             disabled="#{data.disabled}"
                                                             valueChangeListener="#{data.onChange}"
                                                             onchange="submit();"
                                                             filter="true" filterMatchMode="contains"
                                                             >
                                                <f:selectItems value="#{data.items}"/>
                                            </p:selectOneMenu>
                                            <p:commandButton
                                                styleClass="vr-form-dropdown-button"
                                                ajax="false" value=""
                                                icon="fa fa-eye vr-form-button-icon-only"
                                                disabled="#{data.disabledNavigation}"
                                                action="#{vr.gotoPage('obj', data.buildActionCommand())}"/>
                                        </p:panelGrid>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="textarea" for="tarea" >
                                        <p:inputTextarea id="tarea" value="#{data.value}" required="#{data.required}"
                                                         autoResize="false" disabled="#{data.disabled}"
                                                         styleClass="form-control"/>
                                    </pe:dynaFormControl>
                                    <pe:dynaFormControl type="richtextarea" for="trichtextarea" >
                                        <p:textEditor 
                                            id="trichtextarea" value="#{data.value}" required="#{data.required}"
                                            readonly="#{data.disabled}"/>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="wikitextarea" for="twikiarea" >
                                        <p:panelGrid style="border-style: hidden;width: 100%"
                                                     columnClasses="nopadding,nopadding">
                                            <p:row>
                                                <p:column>
                                                    <p:commandButton value="..."
                                                                     action="#{objCtrl.switchWikiTextArea(data)}"
                                                                     update=":listForm"/>
                                                    <h:outputLink target="_blank"
                                                                  value="https://www.mediawiki.org/wiki/Help:Formatting">help?</h:outputLink>
                                                </p:column>
                                            </p:row>
                                            <p:row rendered="#{'Edit'.equals(data.componentState)}">
                                                <p:column>
                                                    <p:inputTextarea id="twikiarea"
                                                                     value="#{data.value}" required="#{data.required}"
                                                                     autoResize="false" disabled="#{data.disabled}"
                                                                     styleClass="form-control"/>
                                                </p:column>
                                            </p:row>
                                            <p:row rendered="#{!('Edit'.equals(data.componentState))}">
                                                <p:column>
                                                    <p:scrollPanel style="width:100%;height:200px" id="twikiareaRender"
                                                                   >
                                                        <p:outputLabel
                                                            value="#{vr.wiki2Html(data.value)}"
                                                            escape="false"
                                                            >
                                                        </p:outputLabel>

                                                    </p:scrollPanel>
                                                </p:column>
                                            </p:row>
                                        </p:panelGrid>

                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="checkbox" for="tcheckbox" >
                                        <p:selectBooleanCheckbox id="tcheckbox" value="#{data.value}"
                                                                 required="#{data.required}" disabled="#{data.disabled}"/>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="rating" for="rat" >
                                        <p:rating id="rat" value="#{data.value}" required="#{data.required}"
                                                  disabled="#{data.disabled}"/>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="separator" styleClass="separator ui-state-disabled" >
                                        <h:panelGrid columns="2" style="width:100%;" columnClasses="separatorText">
                                            <h3>#{data.value}</h3>
                                            <p:separator/>
                                        </h:panelGrid>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="entityDetail">
                                        <p:commandButton ajax="false" value="#{data.count}" disabled="#{data.disabled}"
                                                         action="#{vr.gotoPage('obj', data.buildActionCommand())}"/>
                                    </pe:dynaFormControl>


                                    <!--<pe:dynaFormControl type="profileExpr" for="tprofileexpr" styleClass="select">-->
                                    <!--<p:panelGrid columns="2" style="border-style: hidden"-->
                                    <!--columnClasses="nopadding,nopadding">-->

                                <!--<p:inputText id="tprofileexpr" value="#{data.value}" required="#{data.required}"-->
                                <!--disabled="#{data.disabled}" styleClass="form-control"/>-->
                                    <!--<p:commandButton-->
                                    <!--style="padding-top: 8px; margin-bottom: 3px; margin-left: 1px; padding-bottom: 8px;"-->
                                    <!--ajax="true" value=""-->
                                    <!--icon="fa fa-users"-->
                                    <!--actionListener="#{objCtrl.openPropertyViewDialog(data.componentId,'')}"-->
                                    <!--&gt;-->
                                    <!--<p:ajax event="dialogReturn"-->
                                    <!--listener="#{objCtrl.onPropertyViewDialogClosed}"-->
                                    <!--update="tprofileexpr"/>-->

                                    <!--</p:commandButton>-->
                                    <!--</p:panelGrid>-->
                                    <!--</pe:dynaFormControl>-->

                                    <pe:dynaFormControl type="profileExpr" for="tprofileexpr" styleClass="select" >
                                        <div class="form-group">
                                            <p:autoComplete id="tprofileexpr"
                                                            styleClass="vr-form-control vr-form-control-with-button60"
                                                            placeholder="" value="#{data.value}"
                                                            completeMethod="#{vr.autoCompleteProfileExpression}"
                                                            queryDelay="1000"
                                                            disabled="#{data.disabled}"
                                                            >
                                                <p:ajax event="blur" listener="#{vr.updateProfileExpressionUsersCount}"
                                                        process="@this"
                                                        update="btnto"/>
                                            </p:autoComplete>
                                            <p:commandButton
                                                id="btnto"
                                                styleClass="vr-form-control-right-button60"
                                                ajax="true" value="#{data.hint}"
                                                icon="fa fa-users"
                                                actionListener="#{objCtrl.openPropertyViewDialog(data.componentId,'')}"
                                                >
                                                <p:ajax event="dialogReturn"
                                                        listener="#{objCtrl.onPropertyViewDialogClosed}"
                                                        update="tprofileexpr"/>
                                            </p:commandButton>
                                        </div>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="discipline" for="tdiscipline" styleClass="select" >
                                        <p:panelGrid columns="2" style="border-style: hidden"
                                                     columnClasses="nopadding,nopadding">

                                            <p:inputText id="tdiscipline" value="#{data.value}" required="#{data.required}"
                                                         disabled="#{data.disabled}" styleClass="form-control"/>
                                            <p:commandButton
                                                style="padding-top: 8px; margin-bottom: 3px; margin-left: 1px; padding-bottom: 8px;"
                                                ajax="true" value=""
                                                icon="fa fa-tags"
                                                actionListener="#{objCtrl.openPropertyViewDialog(data.componentId,'')}"
                                                >
                                                <p:ajax event="dialogReturn"
                                                        listener="#{objCtrl.onPropertyViewDialogClosed}"
                                                        update="tdiscipline"/>

                                            </p:commandButton>
                                        </p:panelGrid>
                                    </pe:dynaFormControl>

                                    <pe:dynaFormControl type="file" for="tfile" styleClass="select" >
                                        <div class="form-group">

                                            <p:inputText id="tfile" value="#{data.value}" required="#{data.required}"
                                                         disabled="#{data.disabled}"
                                                         styleClass="form-control vr-form-control vr-form-control-with-button60"/>
                                            <p:commandLink
                                                rendered="#{vr.isFSPath(vr.trim(data.value))}"
                                                target="_blank"
                                                value="..."
                                                styleClass="btn  btn-default vr-form-control-right-button30"
                                                style="margin-left: 3px;margin-right: 3px;margin-top: 5px;"
                                                ajax="false"
                                            >
                                                <p:fileDownload value="#{vr.downloadPath(vr.trim(data.value))}"/>
                                            </p:commandLink>
                                            
                                            <p:commandButton
                                                styleClass="vr-form-control-right-button30"
                                                ajax="true" value=""
                                                icon="fa fa-folder-open-o"
                                                title="Mes Documents"
                                                actionListener="#{objCtrl.openPropertyViewDialog(data.componentId,'folder')}"
                                                >
                                                <p:ajax event="dialogReturn"
                                                        listener="#{objCtrl.onPropertyViewDialogClosed}" update="tfile"/>

                                            </p:commandButton>
                                            <p:commandButton
                                                styleClass="vr-form-control-right-button30"
                                                ajax="true" value=""
                                                icon="fa fa-cloud-upload"
                                                title="Téléverser"
                                                actionListener="#{objCtrl.openPropertyViewDialog(data.componentId,'upload')}"
                                                >
                                                <p:ajax event="dialogReturn"
                                                        listener="#{objCtrl.onPropertyViewDialogClosed}" update="tfile"/>

                                            </p:commandButton>
                                        </div>
                                    </pe:dynaFormControl>


                                </pe:dynaForm>
                            </div>
                        </h:panelGroup>

                    </p:outputPanel>
                    <p:remoteCommand name="processOnSaveCurrentAndClose" process="@form"
                                     update=":listForm   "
                                     action="#{objCtrl.onSaveCurrentAndClose()}"/>
                    <p:remoteCommand name="processOnSaveCurrentAndNext" process="@form"
                                     update=":listForm   "
                                     action="#{objCtrl.onSaveCurrentAndNext()}"/>
                    <p:remoteCommand name="processOnSaveCurrentAndPrevious" process="@form"
                                     update=":listForm   "
                                     action="#{objCtrl.onSaveCurrentAndPrevious()}"/>
                    <p:remoteCommand name="processOnSaveCurrent" process="@form" update=":listForm   "
                                     action="#{objCtrl.onSaveCurrent()}"/>
                    <p:remoteCommand name="processOnCloneCurrent" process="@form" update=":listForm   "
                                     action="#{objCtrl.onCloneCurrent()}"/>
                </h:form>

                <h:outputScript id="dynaFormScript" target="body">
                    /* <![CDATA[ */
                    function handleComplete(xhr, status, args) {
                    if (args && args.isValid) {
                    PF('inputValuesWidget').show();
                    } else {
                    PF('inputValuesWidget').hide();
                    }
                    }

                    /* ]]> */
                </h:outputScript>

                <p:dialog header="Photo" widgetVar="photodlg" modal="true" height="400">
                    <img id="mainPhotoImg" src=""
                         style="width: 400px ; height: 400px; margin-right: 10px;"
                         alt="Image"/>
                </p:dialog>
            </ui:define>


        </ui:composition>


    </h:body>

</html>
